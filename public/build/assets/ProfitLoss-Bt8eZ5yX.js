import{u as D,j as e,H as W,L as m}from"./app-CtQDaI7d.js";import{T as x}from"./InfoIcon-CwQLPO0h.js";import{A as _}from"./AuthenticatedLayout-BmdE4ikK.js";import{f as t}from"./currency-DO5TMxe2.js";import"./transition-TUICTNyj.js";import"./HelpInjector-BfWS8fx6.js";function z({auth:o,filters:d,revenue:r,expense:v,profit:c,rows:h,cogs:n,grossProfit:i,grossMarginPct:p,operatingExpense:b,series:u=[],compare:j={},bucket:S="daily",top:C={products:[],customers:[]}}){const{data:a,setData:y,get:O,processing:R}=D({from:d.from,to:d.to,bucket:S}),N=(s,l=600,E=120,g=8)=>{if(!u||u.length===0)return"";const f=u.map(w=>Number(w[s]||0)),$=Math.max(1,...f),k=Math.min(0,...f),L=$-k||1,T=(l-g*2)/Math.max(1,u.length-1);return f.map((w,G)=>{const F=g+G*T,M=g+(E-g*2)*(1-(w-k)/L);return`${G===0?"M":"L"}${F.toFixed(1)},${M.toFixed(1)}`}).join(" ")},A=s=>{s.preventDefault(),O(route("reports.accounting.profitLoss"),{preserveState:!0})};return e.jsxs(_,{user:o.user,children:[e.jsx(W,{title:"Profit & Loss"}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold flex items-center gap-2",children:["Profit & Loss",e.jsx(x,{text:"Shows Revenue minus all Expenses including computed COGS (purchase taxes/charges allocated). Period is based on From/To dates.",children:"i"})]}),e.jsx(m,{href:route("reports.accounting.profitLoss.export",a),className:"px-3 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700",children:"Export Excel"})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"px-1 pb-3 font-medium",children:"Trends over time"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{width:"800",height:"160",className:"min-w-[800px]",children:[e.jsx("path",{d:N("revenue",800,140),stroke:"#059669",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:N("expense",800,140),stroke:"#ef4444",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:N("cogs",800,140),stroke:"#f59e0b",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:N("gross",800,140),stroke:"#3b82f6",strokeWidth:"2",fill:"none"})]})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-emerald-600 inline-block"})," Revenue"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-red-500 inline-block"})," Expenses"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-amber-500 inline-block"})," COGS"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-blue-500 inline-block"})," Gross Profit"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"font-medium mb-2",children:"Previous Period Comparison"}),j.previous?e.jsx(P,{current:{revenue:r,expense:b,cogs:n,gross:i,profit:c},prev:j.previous}):e.jsx("div",{className:"text-sm text-gray-500",children:"Not available"})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"font-medium mb-2",children:"Year-over-Year Comparison"}),j.yoy?e.jsx(P,{current:{revenue:r,expense:b,cogs:n,gross:i,profit:c},prev:j.yoy}):e.jsx("div",{className:"text-sm text-gray-500",children:"Not available"})]})]}),e.jsxs("form",{onSubmit:A,className:"bg-white shadow rounded p-4 grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"From"}),e.jsx("input",{type:"date",className:"mt-1 w-full border-gray-300 rounded",value:a.from,onChange:s=>y("from",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"To"}),e.jsx("input",{type:"date",className:"mt-1 w-full border-gray-300 rounded",value:a.to,onChange:s=>y("to",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Bucket"}),e.jsxs("select",{className:"mt-1 w-full border-gray-300 rounded",value:a.bucket,onChange:s=>y("bucket",s.target.value),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:R,children:"Apply"})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:["Revenue",e.jsx(x,{text:"Sum of credit balances for revenue accounts within the selected period."})]}),e.jsx("div",{className:"text-2xl font-semibold",children:t(Number(r||0))}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx(m,{href:route("reports.accounting.journals",{from:a.from,to:a.to,scope:"revenue"}),className:"text-indigo-600 hover:underline",children:"View detailed revenue journals →"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:["Expenses",e.jsx(x,{text:"All expense accounts (debits) plus computed COGS from purchases, allocated per unit."})]}),e.jsx("div",{className:"text-2xl font-semibold",children:t(Number(v||0))}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx(m,{href:route("reports.accounting.journals",{from:a.from,to:a.to,scope:"expense"}),className:"text-indigo-600 hover:underline",children:"View detailed expense journals →"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:["Net Profit",e.jsx(x,{text:"Net Profit = Revenue - (Expenses + COGS)."})]}),e.jsx("div",{className:`text-2xl font-semibold ${Number(c)>=0?"text-emerald-600":"text-red-600"}`,children:t(Number(c||0))})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"COGS (Computed)"}),e.jsx("div",{className:"text-xl font-semibold",children:t(Number(n||0))})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Operating Expenses (excl. COGS)"}),e.jsx("div",{className:"text-xl font-semibold",children:t(Number(b||0))})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Gross Profit"}),e.jsx("div",{className:`text-xl font-semibold ${Number(i)>=0?"text-emerald-600":"text-red-600"}`,children:t(Number(i||0))})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Gross Margin %"}),e.jsx("div",{className:"text-xl font-semibold",children:p==null?"-":`${p}%`})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsxs("div",{className:"px-4 py-2 font-medium flex items-center gap-2",children:["Revenue Accounts",e.jsx(x,{text:"Each revenue account shows net credit (credit - debit) over the selected period."})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Code"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Account"}),e.jsxs("th",{className:"px-4 py-2 text-right",children:["Amount ",e.jsx(x,{text:"Net credit balance for the account in this period."})]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:h.revenue.map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:s.code}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(m,{href:route("reports.accounting.journals",{from:a.from,to:a.to,scope:`account:${s.code}`}),className:"text-indigo-600 hover:underline",title:"Drill down to account journals",children:s.name})}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.credit-s.debit))})]},l))})]})]}),e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsxs("div",{className:"px-4 py-2 font-medium flex items-center gap-2",children:["Expense Accounts",e.jsx(x,{text:"Each expense account shows net debit (debit - credit) over the selected period. COGS is appended as a computed expense."})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Code"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Account"}),e.jsxs("th",{className:"px-4 py-2 text-right",children:["Amount ",e.jsx(x,{text:"Net debit balance for the account in this period."})]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:h.expense.map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:s.code}),e.jsx("td",{className:"px-4 py-2",children:s.code==="COGS"?e.jsx("span",{title:"Computed average cost for sold units in period",children:s.name}):e.jsx(m,{href:route("reports.accounting.journals",{from:a.from,to:a.to,scope:`account:${s.code}`}),className:"text-indigo-600 hover:underline",title:"Drill down to account journals",children:s.name})}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.debit-s.credit))})]},l))})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 font-medium",children:"Top Products (by Gross Profit)"}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Product"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Revenue"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"COGS"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Gross"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:(C.products||[]).map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:s.name}),e.jsx("td",{className:"px-4 py-2 text-right",children:Number(s.qty)}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.revenue||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.cogs||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.gross||0))})]},l))})]})]}),e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 font-medium",children:"Top Customers (by Gross Profit)"}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Customer"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Revenue"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"COGS"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Gross"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:(C.customers||[]).map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:s.customer_id?e.jsx(m,{href:route("customers.ledger",s.customer_id),className:"text-indigo-600 hover:underline",title:"Open customer ledger",children:s.name}):e.jsx("span",{children:s.name})}),e.jsx("td",{className:"px-4 py-2 text-right",children:Number(s.qty)}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.revenue||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.cogs||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:t(Number(s.gross||0))})]},l))})]})]})]})]})]})}function P({current:o,prev:d}){const r=({label:c,cur:h,pv:n})=>{const i=Number(h)-Number(n),p=Number(n)!==0?i/Number(n):null;return e.jsxs("div",{className:"grid grid-cols-5 text-sm py-1",children:[e.jsx("div",{className:"col-span-2 text-gray-600",children:c}),e.jsx("div",{className:"text-right",children:t(Number(h||0))}),e.jsx("div",{className:"text-right text-gray-500",children:t(Number(n||0))}),e.jsxs("div",{className:`text-right ${i>=0?"text-emerald-600":"text-red-600"}`,children:[i>=0?"+":"",t(i)," ",p==null?"":" ("+v(p)+")"]})]})},v=c=>`${(c*100).toFixed(1)}%`;return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-5 text-xs text-gray-500 border-b pb-1",children:[e.jsx("div",{className:"col-span-2",children:"Metric"}),e.jsx("div",{className:"text-right",children:"Current"}),e.jsx("div",{className:"text-right",children:"Previous"}),e.jsx("div",{className:"text-right",children:"Δ (%, vs prev)"})]}),e.jsx(r,{label:"Revenue",cur:o.revenue,pv:d.revenue}),e.jsx(r,{label:"Operating Expense",cur:o.expense,pv:d.expense}),e.jsx(r,{label:"COGS",cur:o.cogs,pv:d.cogs}),e.jsx(r,{label:"Gross Profit",cur:o.gross,pv:d.gross}),e.jsx(r,{label:"Net Profit",cur:o.profit,pv:d.profit})]})}export{z as default};

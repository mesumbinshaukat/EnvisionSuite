import{r as o,u as N,j as e,H as _,L as y}from"./app-XRLTg30Q.js";import{A as C}from"./AuthenticatedLayout-lK84dmDI.js";import{T as r}from"./Tooltip-BaMJ1KxZ.js";import{f as n}from"./currency-DO5TMxe2.js";import"./transition-CYqwWJkp.js";function q({purchasedProducts:c=[]}){const[d,h]=o.useState(""),v=o.useMemo(()=>{const s=d.toLowerCase();return s?c.filter(l=>(l.name||"").toLowerCase().includes(s)||(l.sku||"").toLowerCase().includes(s)):c},[d,c]),{data:t,setData:i,post:j,processing:b}=N({product_id:"",cost_basis:"average",fixed_cost:"",margin_type:"percent",margin_value:"20",scope_type:"all_units",scope_qty:"",discount_type:"none",discount_value:"",starts_at:"",ends_at:"",notes:""}),a=o.useMemo(()=>c.find(s=>s.id===parseInt(t.product_id))||null,[t.product_id,c]),m=o.useMemo(()=>a?t.cost_basis==="fixed"?parseFloat(t.fixed_cost||0):t.cost_basis==="last"?parseFloat(a.last_cost||0):parseFloat(a.avg_cost||0):0,[a,t.cost_basis,t.fixed_cost]),u=o.useMemo(()=>{const s=parseFloat(m||0),l=parseFloat(t.margin_value||0);return t.margin_type==="amount"?Math.max(0,s+l):Math.max(0,s*(1+Math.max(0,l)/100))},[m,t.margin_type,t.margin_value]),x=o.useMemo(()=>{const s=parseFloat(u||0),l=parseFloat(t.discount_value||0);return t.discount_type==="amount"?Math.max(0,s-Math.max(0,l)):t.discount_type==="percent"?Math.max(0,s*(1-Math.max(0,Math.min(100,l))/100)):s},[u,t.discount_type,t.discount_value]),p=o.useMemo(()=>{const s=parseInt(t.scope_qty||0);if(!a)return s;const l=parseInt(a.stock??0);return t.scope_type!=="specific_qty"?0:Math.max(0,Math.min(l,isNaN(s)?0:s))},[t.scope_qty,t.scope_type,a]),g=o.useMemo(()=>t.scope_type!=="specific_qty"?0:parseFloat(x||0)*parseInt(p||0)||0,[x,p,t.scope_type]),f=s=>{s.preventDefault(),j(route("pricing.store"))};return e.jsxs(C,{header:e.jsx("h2",{className:"text-xl font-semibold",children:"Set Product Pricing"}),children:[e.jsx(_,{title:"Set Product Pricing"}),e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsxs("div",{className:"rounded bg-white p-4 shadow",children:[e.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:["Purpose: define selling price rules from purchase costs with margins and optional discounts. These rules prefill prices in POS and Sales. ",e.jsx(r,{text:"Pricing rules compute selling price from cost + margin and can include a discount. Scope limits how many units the rule applies to.",children:"i"})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Search Products ",e.jsx(r,{text:"Search by product name or SKU from purchased items.",children:"i"})]}),e.jsx("input",{value:d,onChange:s=>h(s.target.value),className:"mt-1 w-full rounded border p-2",placeholder:"Search by name or SKU"})]}),e.jsxs("div",{className:"w-80",children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Select Product ",e.jsx(r,{text:"Choose a product to base pricing on its purchase costs.",children:"i"})]}),e.jsxs("select",{value:t.product_id,onChange:s=>i("product_id",s.target.value),className:"mt-1 w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"-- choose --"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.sku,") · Stock: ",s.stock??0]},s.id))]})]})]}),a&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Avg Cost"}),e.jsx("div",{className:"font-semibold",children:n(Number(a.avg_cost||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Last Cost"}),e.jsx("div",{className:"font-semibold",children:n(Number(a.last_cost||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Current Price"}),e.jsx("div",{className:"font-semibold",children:n(Number(a.price||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Resolved Cost"}),e.jsx("div",{className:"font-semibold",children:n(Number(m||0))})]}),e.jsxs("div",{className:"rounded border p-3 md:col-span-4",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Available Stock"}),e.jsx("div",{className:"font-semibold",children:Number(a.stock||0)})]})]})]}),e.jsxs("form",{onSubmit:f,className:"rounded bg-white p-4 shadow space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Cost Basis ",e.jsx(r,{text:"How to determine cost: weighted average, last purchase cost, or enter a fixed cost.",children:"i"})]}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:t.cost_basis,onChange:s=>i("cost_basis",s.target.value),children:[e.jsx("option",{value:"average",children:"Weighted Average"}),e.jsx("option",{value:"last",children:"Last Purchase"}),e.jsx("option",{value:"fixed",children:"Fixed Cost"})]})]}),t.cost_basis==="fixed"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Fixed Cost ",e.jsx(r,{text:"Enter your own cost when neither average nor last cost applies.",children:"i"})]}),e.jsx("input",{type:"number",step:"0.0001",min:0,className:"mt-1 w-full rounded border p-2",value:t.fixed_cost,onChange:s=>i("fixed_cost",s.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Margin ",e.jsx(r,{text:"Markup over cost. Choose percent or fixed amount.",children:"i"})]}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsxs("select",{className:"rounded border p-2",value:t.margin_type,onChange:s=>i("margin_type",s.target.value),children:[e.jsx("option",{value:"percent",children:"Percent"}),e.jsx("option",{value:"amount",children:"Amount"})]}),e.jsx("input",{type:"number",step:"0.01",min:0,className:"flex-1 rounded border p-2",value:t.margin_value,onChange:s=>i("margin_value",s.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Scope ",e.jsx(r,{text:"Apply to all units or only a specific quantity (e.g., promo units).",children:"i"})]}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:t.scope_type,onChange:s=>i("scope_type",s.target.value),children:[e.jsx("option",{value:"all_units",children:"All Units"}),e.jsx("option",{value:"specific_qty",children:"Specific Quantity"})]})]}),t.scope_type==="specific_qty"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Scope Quantity ",e.jsx(r,{text:"Number of units this rule applies to. Cannot exceed available stock.",children:"i"})]}),e.jsx("input",{type:"number",min:1,max:Math.max(1,Number(a?.stock??1)),className:"mt-1 w-full rounded border p-2",value:t.scope_qty,onChange:s=>i("scope_qty",s.target.value),title:a?`Max ${a.stock??0}`:""}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:["Clamped to available: ",p]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Discount ",e.jsx(r,{text:"Optional reduction from the base price for promos.",children:"i"})]}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsxs("select",{className:"rounded border p-2",value:t.discount_type,onChange:s=>i("discount_type",s.target.value),children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"percent",children:"Percent"}),e.jsx("option",{value:"amount",children:"Amount"})]}),e.jsx("input",{type:"number",step:"0.01",min:0,className:"flex-1 rounded border p-2",value:t.discount_value,onChange:s=>i("discount_value",s.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Base Price"}),e.jsx("div",{className:"font-semibold",children:n(Number(u||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Sold Price"}),e.jsx("div",{className:"font-semibold",children:n(Number(x||0))})]}),t.scope_type==="specific_qty"&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total (Sold Price × Qty)"}),e.jsx("div",{className:"font-semibold",children:n(Number(g||0))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Starts At ",e.jsx(r,{text:"When this pricing rule becomes active.",children:"i"})]}),e.jsx("input",{type:"datetime-local",className:"mt-1 w-full rounded border p-2",value:t.starts_at,onChange:s=>i("starts_at",s.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Ends At ",e.jsx(r,{text:"When this pricing rule expires (optional).",children:"i"})]}),e.jsx("input",{type:"datetime-local",className:"mt-1 w-full rounded border p-2",value:t.ends_at,onChange:s=>i("ends_at",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Notes ",e.jsx(r,{text:"Internal notes about this rule (optional).",children:"i"})]}),e.jsx("textarea",{className:"mt-1 w-full rounded border p-2",rows:3,value:t.notes,onChange:s=>i("notes",s.target.value)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{href:route("products.index"),className:"rounded border px-4 py-2",children:"Back"}),e.jsx("button",{disabled:b||!t.product_id,className:"rounded bg-blue-600 px-4 py-2 text-white",children:"Save Pricing Rule"})]})]})]})]})}export{q as default};

import{r as o,u as y,j as e,H as v,L as j}from"./app-CesMltMj.js";import{f as u}from"./currency-DO5TMxe2.js";import{A as _}from"./AuthenticatedLayout-B8AMudpm.js";import"./transition-DRm8Zbpx.js";function P({purchasedProducts:l=[]}){const[d,x]=o.useState(""),g=o.useMemo(()=>{const s=d.toLowerCase();return s?l.filter(c=>(c.name||"").toLowerCase().includes(s)||(c.sku||"").toLowerCase().includes(s)):l},[d,l]),{data:t,setData:r,post:b,processing:p}=y({product_id:"",cost_basis:"fixed",fixed_cost:"",margin_type:"percent",margin_value:"20",scope_type:"all_units",scope_qty:"",discount_type:"none",discount_value:"0",starts_at:"",ends_at:"",notes:""}),a=o.useMemo(()=>l.find(s=>s.id===parseInt(t.product_id))||null,[t.product_id,l]),n=o.useMemo(()=>a?t.cost_basis==="fixed"?parseFloat(t.fixed_cost||0):t.cost_basis==="last"?parseFloat(a.last_cost||0):parseFloat(a.avg_cost||0):0,[a,t.cost_basis,t.fixed_cost]),i=o.useMemo(()=>t.margin_type==="percent"?n*(1+parseFloat(t.margin_value||0)/100):n+parseFloat(t.margin_value||0),[n,t.margin_type,t.margin_value]),m=o.useMemo(()=>t.discount_type==="percent"?i*(1-parseFloat(t.discount_value||0)/100):t.discount_type==="amount"?Math.max(0,i-parseFloat(t.discount_value||0)):i,[i,t.discount_type,t.discount_value]),f=s=>{s.preventDefault(),t.discount_type==="none"&&r("discount_value","0"),b(route("pricing.store"))},h=s=>{const c=s.target.value;r("discount_type",c),c==="none"&&r("discount_value","0")};return e.jsxs(_,{header:e.jsx("h2",{className:"text-xl font-semibold",children:"Create Pricing Rule"}),children:[e.jsx(v,{title:"Create Pricing Rule"}),e.jsx("div",{className:"mx-auto max-w-4xl p-6",children:e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:d,onChange:s=>x(s.target.value)}),d&&e.jsx("div",{className:"mt-2 max-h-60 overflow-y-auto border border-gray-200 rounded-md",children:g.map(s=>e.jsxs("div",{className:`p-3 cursor-pointer hover:bg-gray-50 border-b border-gray-100 ${t.product_id===s.id.toString()?"bg-blue-50 border-blue-200":""}`,onClick:()=>{r("product_id",s.id.toString()),x(s.name)},children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",s.sku," | Stock: ",s.stock," | Price: Rs ",s.price]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Basis"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.cost_basis,onChange:s=>r("cost_basis",s.target.value),children:[e.jsx("option",{value:"last",children:"Last Purchase"}),e.jsx("option",{value:"average",children:"Weighted Average"}),e.jsx("option",{value:"fixed",children:"Fixed Cost/Buy Price"})]})]}),t.cost_basis==="fixed"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fixed Cost / Buy Price (Rs)"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.fixed_cost,onChange:s=>r("fixed_cost",s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selling Price"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.margin_type,onChange:s=>r("margin_type",s.target.value),children:[e.jsx("option",{value:"percent",children:"Percentage (%)"}),e.jsx("option",{value:"amount",children:"Fixed Amount (Rs)"})]}),e.jsx("input",{type:"number",step:"0.01",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.margin_value,onChange:s=>r("margin_value",s.target.value),placeholder:t.margin_type==="percent"?"20":"5.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scope"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.scope_type,onChange:s=>r("scope_type",s.target.value),children:[e.jsx("option",{value:"all_units",children:"All Units"}),e.jsx("option",{value:"specific_qty",children:"Specific Quantity"})]})]}),t.scope_type==="specific_qty"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scope Quantity"}),e.jsx("input",{type:"number",min:"1",max:a?.stock||999999,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.scope_qty,onChange:s=>r("scope_qty",s.target.value),placeholder:"1"}),a&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Available stock: ",a.stock," units"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.discount_type,onChange:h,children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"percent",children:"Percentage (%)"}),e.jsx("option",{value:"amount",children:"Fixed Amount ($)"})]}),t.discount_type!=="none"&&e.jsx("input",{type:"number",step:"0.01",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.discount_value,onChange:s=>r("discount_value",s.target.value),placeholder:t.discount_type==="percent"?"10":"2.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date (Optional)"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.starts_at,onChange:s=>r("starts_at",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date (Optional)"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.ends_at,onChange:s=>r("ends_at",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",value:t.notes,onChange:s=>r("notes",s.target.value),placeholder:"Additional notes about this pricing rule..."})]}),a&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Price Preview (Rs)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cost Basis:"}),e.jsx("span",{className:"ml-2 font-medium",children:u(Number(n||0))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Selling Price:"}),e.jsx("span",{className:"ml-2 font-medium",children:u(Number(i||0))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Final Price:"}),e.jsx("span",{className:"ml-2 font-medium text-green-600",children:u(Number(m||0))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Profit Margin:"}),e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:[u(Number(m-n||0))," (",n?((m-n)/n*100).toFixed(2):"0.00","%)"]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(j,{href:route("pricing.index"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p||!t.product_id,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:p?"Creating...":"Create Pricing Rule"})]})]})})]})}export{P as default};

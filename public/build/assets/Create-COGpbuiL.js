import{a as T,r as i,u as E,j as e,H as Q,L as j}from"./app-DOMoObF9.js";import{A as V}from"./AuthenticatedLayout-CyyCBi49.js";import"./transition-DNtpkwaD.js";function D({vendors:v=[],products:o=[]}){const{props:f}=T(),x=f.flash?.vendorCreated,[m,_]=i.useState(""),w=i.useMemo(()=>{const s=m.toLowerCase();return v.filter(t=>t.name?.toLowerCase().includes(s)||t.email?.toLowerCase().includes(s))},[m,v]),[u,C]=i.useState(""),P=i.useMemo(()=>{const s=u.toLowerCase();return o.filter(t=>t.name?.toLowerCase().includes(s)||t.sku?.toLowerCase().includes(s))},[u,o]),{data:a,setData:r,post:S,processing:F,errors:N}=E({vendor_id:"",vendor_name:"",vendor_email:"",vendor_phone:"",items:[],tax_percent:0,other_charges:0,notes:"",payment_method:"",amount_paid:0}),[h,L]=i.useState([]);i.useEffect(()=>{const s=h.map(t=>{const l=o.find(d=>d.id===t);return a.items.find(d=>d.product_id===t)||{product_id:t,quantity:1,unit_cost:l?.price??0}});r("items",s)},[h]);const p=(a.items||[]).reduce((s,t)=>s+Number(t.quantity||0)*Number(t.unit_cost||0),0),b=Number((p*(Number(a.tax_percent||0)/100)).toFixed(2)),y=Number((p+b+Number(a.other_charges||0)).toFixed(2)),k=Math.max(0,Number((y-Number(a.amount_paid||0)).toFixed(2))),q=s=>{s.preventDefault(),S(route("purchases.store"))};return e.jsxs(V,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"New Purchase"}),children:[e.jsx(Q,{title:"New Purchase"}),e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"rounded bg-white p-4 shadow space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Vendor"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{value:m,onChange:s=>_(s.target.value),placeholder:"Search vendor by name or email",className:"w-full rounded border px-3 py-2"}),e.jsxs("select",{value:a.vendor_id,onChange:s=>r("vendor_id",s.target.value?Number(s.target.value):""),className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select existing vendor"}),w.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.email?`(${s.email})`:""]},s.id))]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx("input",{value:a.vendor_name,onChange:s=>r("vendor_name",s.target.value),placeholder:"New vendor name (auto-create if not found)",className:"rounded border px-3 py-2"}),e.jsx("input",{value:a.vendor_email,onChange:s=>r("vendor_email",s.target.value),placeholder:"Email",className:"rounded border px-3 py-2"}),e.jsx("input",{value:a.vendor_phone,onChange:s=>r("vendor_phone",s.target.value),placeholder:"Phone",className:"rounded border px-3 py-2"})]}),N.vendor_id&&e.jsx("div",{className:"text-sm text-red-600",children:N.vendor_id})]})]}),e.jsxs("div",{className:"rounded bg-white p-4 shadow space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Products"}),e.jsx("input",{value:u,onChange:s=>C(s.target.value),placeholder:"Search products by name or SKU",className:"w-full rounded border px-3 py-2"}),e.jsx("div",{className:"rounded border",children:e.jsx("div",{className:"max-h-48 overflow-y-auto",children:P.map(s=>{const t=h.includes(s.id);return e.jsxs("label",{className:"flex items-center gap-3 border-b px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:()=>{L(l=>t?l.filter(c=>c!==s.id):[...l,s.id])}}),e.jsxs("span",{className:"flex-1",children:[s.name," ",s.sku?`(${s.sku})`:""]})]},s.id)})})}),a.items.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Product"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Cost"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Line Total"})]})}),e.jsx("tbody",{children:a.items.map((s,t)=>{const l=o.find(d=>d.id===s.product_id),c=Number(s.quantity||0)*Number(s.unit_cost||0);return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-2 py-2",children:l?.name}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("input",{type:"number",min:1,value:s.quantity,onChange:d=>{const g=Number(d.target.value||0),n=[...a.items];n[t]={...n[t],quantity:g},r("items",n)},className:"w-24 rounded border px-2 py-1 text-right"})}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("input",{type:"number",min:0,step:"0.01",value:s.unit_cost,onChange:d=>{const g=Number(d.target.value||0),n=[...a.items];n[t]={...n[t],unit_cost:g},r("items",n)},className:"w-28 rounded border px-2 py-1 text-right"})}),e.jsx("td",{className:"px-2 py-2 text-right",children:c.toFixed(2)})]},s.product_id)})})]})})]}),e.jsxs("div",{className:"rounded bg-white p-4 shadow space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Totals & Payment"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Tax Percent"}),e.jsx("input",{type:"number",min:0,step:"0.01",value:a.tax_percent,onChange:s=>r("tax_percent",Number(s.target.value||0)),className:"w-full rounded border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Other Charges"}),e.jsx("input",{type:"number",min:0,step:"0.01",value:a.other_charges,onChange:s=>r("other_charges",Number(s.target.value||0)),className:"w-full rounded border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Amount Paid Now"}),e.jsx("input",{type:"number",min:0,step:"0.01",value:a.amount_paid,onChange:s=>r("amount_paid",Number(s.target.value||0)),className:"w-full rounded border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Payment Method"}),e.jsxs("select",{value:a.payment_method,onChange:s=>r("payment_method",s.target.value),className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank",children:"Bank"}),e.jsx("option",{value:"credit",children:"On Credit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Notes"}),e.jsx("input",{value:a.notes,onChange:s=>r("notes",s.target.value),className:"w-full rounded border px-3 py-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Subtotal"}),e.jsx("div",{className:"text-xl font-semibold",children:p.toFixed(2)})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Tax"}),e.jsx("div",{className:"text-xl font-semibold",children:b.toFixed(2)})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Other Charges"}),e.jsx("div",{className:"text-xl font-semibold",children:Number(a.other_charges||0).toFixed(2)})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Grand Total"}),e.jsx("div",{className:"text-xl font-semibold",children:y.toFixed(2)})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Remaining"}),e.jsx("div",{className:"text-xl font-semibold",children:k.toFixed(2)})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(j,{href:route("purchases.index"),className:"rounded border px-4 py-2",children:"Cancel"}),e.jsx("button",{disabled:F,className:"rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",children:"Save Purchase"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"w-full max-w-md rounded bg-white p-6 shadow",children:[e.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"Vendor Created"}),e.jsxs("p",{className:"mb-4 text-sm text-gray-700",children:["A new vendor was created: ",x.name,". You can update details now."]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{href:route().has("vendors.edit")?route("vendors.edit",x.id):"#",className:"rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"Edit Vendor"}),e.jsx(j,{href:route("purchases.index"),className:"rounded border px-4 py-2",children:"Close"})]})]})})]})]})}export{D as default};

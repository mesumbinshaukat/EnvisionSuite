import{a as V,r as u,u as M,j as e,H,L as f}from"./app-CbYj9284.js";import{A as D}from"./AuthenticatedLayout-DIkmjlaX.js";import{T as r}from"./Tooltip-D9SVt6Bn.js";import{C as p}from"./Currency-i8JMpeXZ.js";import"./transition-Datl3Aea.js";function $({vendors:_=[],products:g=[]}){const{props:S}=V(),j=S.flash?.vendorCreated,[N,T]=u.useState(""),q=u.useMemo(()=>{const t=N.toLowerCase();return _.filter(s=>s.name?.toLowerCase().includes(t)||s.email?.toLowerCase().includes(t))},[N,_]),[b,L]=u.useState(""),k=u.useMemo(()=>{const t=b.toLowerCase();return g.filter(s=>s.name?.toLowerCase().includes(t)||s.sku?.toLowerCase().includes(t))},[b,g]),{data:a,setData:i,post:F,processing:A,errors:w}=M({vendor_id:"",vendor_name:"",vendor_email:"",vendor_phone:"",items:[],tax_percent:0,other_charges:0,notes:"",payment_method:"",amount_paid:0}),[v,E]=u.useState([]);u.useEffect(()=>{const t=v.map(s=>{const l=g.find(o=>o.id===s);return a.items.find(o=>o.product_id===s)||{product_id:s,quantity:1,unit_cost:l?.price??0}});i("items",t)},[v]);const y=(a.items||[]).reduce((t,s)=>{const l=Number(s.quantity||0),x=Number(s.unit_cost||0),o=s.line_total!=null?Number(s.line_total||0):l*x;return t+o},0),C=Number((y*(Number(a.tax_percent||0)/100)).toFixed(2)),P=Number((y+C+Number(a.other_charges||0)).toFixed(2)),Q=Math.max(0,Number((P-Number(a.amount_paid||0)).toFixed(2))),U=t=>{t.preventDefault(),F(route("purchases.store"))};return e.jsxs(D,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"New Purchase"}),children:[e.jsx(H,{title:"New Purchase"}),e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("div",{className:"rounded bg-white p-4 shadow space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:["Vendor ",e.jsx(r,{text:"Select an existing vendor or enter details to auto-create.",children:"i"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:N,onChange:t=>T(t.target.value),placeholder:"Search vendor by name or email",className:"w-full rounded border px-3 py-2"}),e.jsx(r,{text:"Type to search vendors; select below.",children:"i"})]}),e.jsxs("select",{value:a.vendor_id,onChange:t=>i("vendor_id",t.target.value?Number(t.target.value):""),className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select existing vendor"}),q.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.email?`(${t.email})`:""]},t.id))]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx("input",{value:a.vendor_name,onChange:t=>i("vendor_name",t.target.value),placeholder:"New vendor name (auto-create if not found)",className:"rounded border px-3 py-2"}),e.jsx("input",{value:a.vendor_email,onChange:t=>i("vendor_email",t.target.value),placeholder:"Email",className:"rounded border px-3 py-2"}),e.jsx("input",{value:a.vendor_phone,onChange:t=>i("vendor_phone",t.target.value),placeholder:"Phone",className:"rounded border px-3 py-2"})]}),w.vendor_id&&e.jsx("div",{className:"text-sm text-red-600",children:w.vendor_id})]})]}),e.jsxs("div",{className:"rounded bg-white p-4 shadow space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:["Products ",e.jsx(r,{text:"Pick products to add purchase lines.",children:"i"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:b,onChange:t=>L(t.target.value),placeholder:"Search products by name or SKU",className:"w-full rounded border px-3 py-2"}),e.jsx(r,{text:"Search by name or SKU, then tick items below.",children:"i"})]}),e.jsx("div",{className:"rounded border",children:e.jsx("div",{className:"max-h-48 overflow-y-auto",children:k.map(t=>{const s=v.includes(t.id);return e.jsxs("label",{className:"flex items-center gap-3 border-b px-3 py-2",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:()=>{E(l=>s?l.filter(x=>x!==t.id):[...l,t.id])}}),e.jsxs("span",{className:"flex-1",children:[t.name," ",t.sku?`(${t.sku})`:""]})]},t.id)})})}),a.items.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"px-2 py-2 text-left",children:["Product ",e.jsx(r,{text:"The item being purchased.",children:"i"})]}),e.jsxs("th",{className:"px-2 py-2 text-right",children:["Qty ",e.jsx(r,{text:"Number of units for this line.",children:"i"})]}),e.jsxs("th",{className:"px-2 py-2 text-right",children:["Unit Cost ",e.jsx(r,{text:"Cost per unit. Editing this updates Line Total.",children:"i"})]}),e.jsxs("th",{className:"px-2 py-2 text-right",children:["Line Total ",e.jsx(r,{text:"Total cost for this line. You can edit this and we will compute Unit Cost = Line Total / Qty.",children:"i"})]})]})}),e.jsx("tbody",{children:a.items.map((t,s)=>{const l=g.find(c=>c.id===t.product_id),x=Number(t.quantity||0),o=Number(t.unit_cost||0),O=t.line_total!=null?Number(t.line_total||0):x*o;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-2 py-2",children:l?.name}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("input",{type:"number",min:1,value:t.quantity,onChange:c=>{const d=Number(c.target.value||0),n=[...a.items];n[s].line_total!=null?Number(n[s].line_total||0):Number(n[s].quantity||0)*Number(n[s].unit_cost||0);const m=Number(n[s].unit_cost||0),h=Number((d*m).toFixed(2));n[s]={...n[s],quantity:d,line_total:h},i("items",n)},className:"w-24 rounded border px-2 py-1 text-right"})}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("input",{type:"number",min:0,step:"0.01",value:t.unit_cost,onChange:c=>{const d=Number(c.target.value||0),n=[...a.items],m=Number(n[s].quantity||0),h=Number((m*d).toFixed(2));n[s]={...n[s],unit_cost:d,line_total:h},i("items",n)},className:"w-28 rounded border px-2 py-1 text-right"})}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("input",{type:"number",min:0,step:"0.01",value:Number(O||0),onChange:c=>{const d=Number(c.target.value||0),n=[...a.items],m=Number(n[s].quantity||0)||1,h=Number((d/m).toFixed(2));n[s]={...n[s],line_total:d,unit_cost:h},i("items",n)},className:"w-32 rounded border px-2 py-1 text-right"})})]},t.product_id)})})]})})]}),e.jsxs("div",{className:"rounded bg-white p-4 shadow space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:["Totals & Payment ",e.jsx(r,{text:"Taxes and charges adjust the grand total; remaining = grand - amount paid.",children:"i"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Tax Percent ",e.jsx(r,{text:"Percentage applied to subtotal.",children:"i"})]}),e.jsx("input",{type:"number",min:0,step:"0.01",value:a.tax_percent,onChange:t=>i("tax_percent",Number(t.target.value||0)),className:"w-full rounded border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Other Charges ",e.jsx(r,{text:"Shipping or additional fees.",children:"i"})]}),e.jsx("input",{type:"number",min:0,step:"0.01",value:a.other_charges,onChange:t=>i("other_charges",Number(t.target.value||0)),className:"w-full rounded border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Amount Paid Now ",e.jsx(r,{text:"Payment at time of purchase.",children:"i"})]}),e.jsx("input",{type:"number",min:0,step:"0.01",value:a.amount_paid,onChange:t=>i("amount_paid",Number(t.target.value||0)),className:"w-full rounded border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Payment Method ",e.jsx(r,{text:"How this purchase was paid.",children:"i"})]}),e.jsxs("select",{value:a.payment_method,onChange:t=>i("payment_method",t.target.value),className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank",children:"Bank"}),e.jsx("option",{value:"credit",children:"On Credit"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Notes ",e.jsx(r,{text:"Optional notes for this purchase.",children:"i"})]}),e.jsx("input",{value:a.notes,onChange:t=>i("notes",t.target.value),className:"w-full rounded border px-3 py-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Subtotal ",e.jsx(r,{text:"Sum of line totals.",children:"i"})]}),e.jsx("div",{className:"text-xl font-semibold",children:e.jsx(p,{value:y})})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Tax ",e.jsx(r,{text:"Calculated from tax percent.",children:"i"})]}),e.jsx("div",{className:"text-xl font-semibold",children:e.jsx(p,{value:C})})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Other Charges ",e.jsx(r,{text:"Additional fees added to total.",children:"i"})]}),e.jsx("div",{className:"text-xl font-semibold",children:e.jsx(p,{value:Number(a.other_charges||0)})})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Grand Total ",e.jsx(r,{text:"Subtotal + Tax + Other Charges.",children:"i"})]}),e.jsx("div",{className:"text-xl font-semibold",children:e.jsx(p,{value:P})})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:["Remaining ",e.jsx(r,{text:"Grand Total minus Amount Paid.",children:"i"})]}),e.jsx("div",{className:"text-xl font-semibold",children:e.jsx(p,{value:Q})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(f,{href:route("purchases.index"),className:"rounded border px-4 py-2",children:"Cancel"}),e.jsx("button",{disabled:A,className:"rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",children:"Save Purchase"})]})]}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"w-full max-w-md rounded bg-white p-6 shadow",children:[e.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"Vendor Created"}),e.jsxs("p",{className:"mb-4 text-sm text-gray-700",children:["A new vendor was created: ",j.name,". You can update details now."]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{href:route().has("vendors.edit")?route("vendors.edit",j.id):"#",className:"rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"Edit Vendor"}),e.jsx(f,{href:route("purchases.index"),className:"rounded border px-4 py-2",children:"Close"})]})]})})]})]})}export{$ as default};

import{u as T,j as e,H as _}from"./app-CbYj9284.js";import{A as w}from"./AuthenticatedLayout-DIkmjlaX.js";import{T as S}from"./Tooltip-D9SVt6Bn.js";import{f as c}from"./currency-DO5TMxe2.js";import"./transition-Datl3Aea.js";function L({customers:j,products:o}){const{data:r,setData:m,post:b,processing:N,errors:u}=T({customer_id:"",payment_method:"cash",items:[]}),y=t=>{const a=o.find(s=>s.id===parseInt(t));a&&m("items",[...r.items,{product_id:a.id,quantity:1}])},f=(t,a)=>{const s=[...r.items],l=s[t],i=o.find(h=>h.id===l.product_id),d=Math.max(0,parseInt(i?.stock??0));let n=parseInt(a)||1;d>0&&n>d&&(n=d),n<1&&(n=1),s[t].quantity=n,m("items",s)},v=t=>{const a=[...r.items];a.splice(t,1),m("items",a)},g=t=>{t.preventDefault(),b(route("pos.checkout"))},p=t=>{const a=o.find(k=>k.id===t.product_id),s=Number(a?.price||0),l=Number(t.quantity||0),i=Number(a?.tax_rate||0),d=s*l,n=d*Math.max(0,i)/100,h=d+n;return{price:s,qty:l,taxRate:i,lineSubtotal:d,lineTax:n,lineTotal:h}},x=r.items.reduce((t,a)=>{const s=p(a);return t.subtotal+=s.lineSubtotal,t.tax+=s.lineTax,t.total+=s.lineTotal,t},{subtotal:0,tax:0,total:0});return e.jsxs(w,{header:e.jsx("h2",{className:"text-xl font-semibold",children:"Point of Sale"}),children:[e.jsx(_,{title:"POS"}),e.jsx("div",{className:"mx-auto max-w-5xl p-6",children:e.jsxs("form",{onSubmit:g,className:"space-y-4 bg-white p-6 shadow rounded",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Customer"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:r.customer_id,onChange:t=>m("customer_id",t.target.value),children:[e.jsx("option",{value:"",children:"Walk-in"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Payment"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:r.payment_method,onChange:t=>m("payment_method",t.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Add Product ",e.jsx(S,{text:"Add items to the cart. Quantity cannot exceed available stock.",children:"i"})]}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",onChange:t=>y(t.target.value),children:[e.jsx("option",{value:"",children:"Select product"}),o.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.sku,") - Stock: ",t.stock??0]},t.id))]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Product"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Line Subtotal"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Tax"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Line Total"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Available"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:r.items.map((t,a)=>{const s=o.find(i=>i.id===t.product_id),l=p(t);return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-2 py-2",children:s?.name}),e.jsx("td",{className:"px-2 py-2 text-right",children:c(l.price)}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("input",{type:"number",min:1,max:Math.max(1,s?.stock??1),className:"w-24 rounded border p-2",value:t.quantity,onChange:i=>f(a,i.target.value),title:`Max ${s?.stock??0} available`})}),e.jsx("td",{className:"px-2 py-2 text-right",children:c(l.lineSubtotal)}),e.jsx("td",{className:"px-2 py-2 text-right",children:c(l.lineTax)}),e.jsx("td",{className:"px-2 py-2 text-right font-semibold",children:c(l.lineTotal)}),e.jsx("td",{className:"px-2 py-2 text-right",children:s?.stock??0}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>v(a),className:"text-red-600",children:"Remove"})})]},a)})})]})}),u.items&&e.jsx("div",{className:"text-sm text-red-600",children:u.items}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Subtotal: ",e.jsx("span",{className:"font-semibold",children:c(x.subtotal)})]}),e.jsxs("div",{children:["Tax: ",e.jsx("span",{className:"font-semibold",children:c(x.tax)})]}),e.jsxs("div",{children:["Total: ",e.jsx("span",{className:"font-semibold",children:c(x.total)})]})]}),e.jsx("button",{disabled:N,className:"rounded bg-blue-600 px-4 py-2 text-white",children:"Checkout"})]})]})})]})}export{L as default};

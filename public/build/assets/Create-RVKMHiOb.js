import{u as y,a as j,r as g,j as e,H as N,L as x}from"./app-DUaT__wH.js";import{A as f}from"./AuthenticatedLayout-BRA9NZV-.js";import"./transition-7jmKK-Rq.js";import"./HelpInjector-BCvt9IJE.js";import"./InfoIcon-ISLSAj6V.js";function S({auth:p,vendors:u,vendorDebts:m={},balances:i={}}){const{t}=y(),{data:r,setData:n,post:h,processing:v,errors:s}=j({counterparty_type:"vendor",vendor_id:u?.[0]?.id??"",counterparty_name:"",direction:"lend",source:"cash",amount:"",date:new Date().toISOString().slice(0,10),note:"",purpose:"general"}),d=a=>Number(a||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),l=g.useMemo(()=>{const a=r.vendor_id?Number(r.vendor_id):null;if(!a)return 0;const o=m?.[a]??0;return Number(o||0)},[r.vendor_id,m]),c=r.source==="bank"?Number(i?.bank||0):Number(i?.cash||0),b=a=>{a.preventDefault();const o=Number(r.amount||0);if(o<=0){alert(t("amount")+" "+t("must_be_positive"));return}if((r.direction==="lend"||r.purpose==="vendor_payoff")&&o>c+1e-6){alert(t("insufficient_funds")+`: ${t(r.source)} ${d(c)}`);return}if(r.purpose==="vendor_payoff"){if(r.counterparty_type!=="vendor"||!r.vendor_id){alert(t("vendor")+" "+t("is_required"));return}if(o>l+1e-6){alert(t("amount")+" > "+t("Pending Debt")+` (${d(l)})`);return}if(l<=0){alert(t("No Pending Debt For Selected Vendor"));return}}h(route("transactions.store"))};return e.jsxs(f,{user:p?.user,children:[e.jsx(N,{title:t("transactions")}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold","data-help-key":"transactions_create_title",children:t("transactions")}),e.jsx(x,{href:route("transactions.index"),className:"px-3 py-2 bg-gray-100 rounded",children:t("back")})]}),e.jsxs("form",{onSubmit:b,className:"bg-white p-4 rounded shadow space-y-4 max-w-2xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-gray-500",children:[t("cash")," ",t("balance")]}),e.jsx("div",{className:"font-semibold",children:d(i?.cash)})]}),e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-gray-500",children:[t("bank")," ",t("balance")]}),e.jsx("div",{className:"font-semibold",children:d(i?.bank)})]}),r.counterparty_type==="vendor"&&e.jsxs("div",{className:"p-3 rounded border bg-amber-50",children:[e.jsx("div",{className:"text-gray-600",children:t("Pending Debt")}),e.jsx("div",{className:"font-semibold",children:d(l)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_counterparty_type",children:t("counterparty_type")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:r.counterparty_type,onChange:a=>n("counterparty_type",a.target.value),children:[e.jsx("option",{value:"vendor",children:t("vendor")}),e.jsx("option",{value:"external",children:t("external_person")})]}),s.counterparty_type&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.counterparty_type})]}),r.counterparty_type==="vendor"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_vendor",children:t("vendor")}),e.jsx("select",{className:"w-full border rounded px-3 py-2",value:r.vendor_id??"",onChange:a=>n("vendor_id",a.target.value),children:(u||[]).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))}),s.vendor_id&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.vendor_id})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_counterparty_name",children:t("external_person")}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:r.counterparty_name,onChange:a=>n("counterparty_name",a.target.value)}),s.counterparty_name&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.counterparty_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_direction",children:t("direction")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:r.direction,onChange:a=>n("direction",a.target.value),children:[e.jsx("option",{value:"lend",children:t("lend")}),e.jsx("option",{value:"borrow",children:t("borrow")})]}),s.direction&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.direction})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_purpose",children:t("purpose")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:r.purpose,onChange:a=>n("purpose",a.target.value),children:[e.jsx("option",{value:"general",children:t("general")}),e.jsx("option",{value:"vendor_payoff",children:t("Payoff Vendor Debt")})]}),s.purpose&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.purpose})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_source",children:t("source")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:r.source,onChange:a=>n("source",a.target.value),children:[e.jsx("option",{value:"cash",children:t("cash")}),e.jsx("option",{value:"bank",children:t("bank")})]}),s.source&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.source})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_amount",children:t("amount")}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full border rounded px-3 py-2",value:r.amount,onChange:a=>n("amount",a.target.value),max:r.purpose==="vendor_payoff"?l:void 0}),s.amount&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.amount}),(r.direction==="lend"||r.purpose==="vendor_payoff")&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t("available")," ",t(r.source),": ",d(c)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_date",children:t("date")}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:r.date,onChange:a=>n("date",a.target.value)}),s.date&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.date})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"transactions_note",children:t("note")}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:r.note,onChange:a=>n("note",a.target.value)}),s.note&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:s.note})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{disabled:v,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-60",children:t("save")}),e.jsx(x,{href:route("transactions.index"),className:"px-4 py-2 bg-gray-100 rounded",children:t("cancel")})]})]})]})]})}export{S as default};

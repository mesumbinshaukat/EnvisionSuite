import{r as i,u as b,j as e,H as g,L as f}from"./app-6_YAhG1R.js";import{f as d}from"./currency-DO5TMxe2.js";import{A as N}from"./AuthenticatedLayout-BCtfOo9J.js";import"./transition-BX3gIKzB.js";function k({purchasedProducts:n=[]}){const[o,u]=i.useState(""),x=i.useMemo(()=>{const s=o.toLowerCase();return s?n.filter(r=>(r.name||"").toLowerCase().includes(s)||(r.sku||"").toLowerCase().includes(s)):n},[o,n]),{data:t,setData:a,post:p,processing:h}=b({product_id:"",cost_basis:"average",fixed_cost:"",margin_type:"percent",margin_value:"20",scope_type:"all_units",scope_qty:"",discount_type:"none",discount_value:"",starts_at:"",ends_at:"",notes:""}),l=i.useMemo(()=>n.find(s=>s.id===parseInt(t.product_id))||null,[t.product_id,n]),c=i.useMemo(()=>l?t.cost_basis==="fixed"?parseFloat(t.fixed_cost||0):t.cost_basis==="last"?parseFloat(l.last_cost||0):parseFloat(l.avg_cost||0):0,[l,t.cost_basis,t.fixed_cost]),m=i.useMemo(()=>{const s=parseFloat(c||0),r=parseFloat(t.margin_value||0);return t.margin_type==="amount"?Math.max(0,s+r):Math.max(0,s*(1+Math.max(0,r)/100))},[c,t.margin_type,t.margin_value]),v=i.useMemo(()=>{const s=parseFloat(m||0),r=parseFloat(t.discount_value||0);return t.discount_type==="amount"?Math.max(0,s-Math.max(0,r)):t.discount_type==="percent"?Math.max(0,s*(1-Math.max(0,Math.min(100,r))/100)):s},[m,t.discount_type,t.discount_value]),j=s=>{s.preventDefault(),p(route("pricing.store"))};return e.jsxs(N,{header:e.jsx("h2",{className:"text-xl font-semibold",children:"Create Pricing Rule"}),children:[e.jsx(g,{title:"Create Pricing Rule"}),e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsxs("div",{className:"rounded bg-white p-4 shadow",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Search Products"}),e.jsx("input",{value:o,onChange:s=>u(s.target.value),className:"mt-1 w-full rounded border p-2",placeholder:"Search by name or SKU"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Product"}),e.jsxs("select",{value:t.product_id,onChange:s=>a("product_id",s.target.value),className:"mt-1 w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"-- choose --"}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.sku,")"]},s.id))]})]})]}),l&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Avg Cost"}),e.jsx("div",{className:"font-semibold",children:d(Number(l.avg_cost||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Last Cost"}),e.jsx("div",{className:"font-semibold",children:d(Number(l.last_cost||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Current Price"}),e.jsx("div",{className:"font-semibold",children:d(Number(l.price||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Resolved Cost"}),e.jsx("div",{className:"font-semibold",children:d(Number(c||0))})]})]})]}),e.jsxs("form",{onSubmit:j,className:"rounded bg-white p-4 shadow space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Cost Basis"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:t.cost_basis,onChange:s=>a("cost_basis",s.target.value),children:[e.jsx("option",{value:"average",children:"Weighted Average"}),e.jsx("option",{value:"last",children:"Last Purchase"}),e.jsx("option",{value:"fixed",children:"Fixed Cost"})]})]}),t.cost_basis==="fixed"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Fixed Cost"}),e.jsx("input",{type:"number",step:"0.0001",min:0,className:"mt-1 w-full rounded border p-2",value:t.fixed_cost,onChange:s=>a("fixed_cost",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Margin"}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsxs("select",{className:"rounded border p-2",value:t.margin_type,onChange:s=>a("margin_type",s.target.value),children:[e.jsx("option",{value:"percent",children:"Percent"}),e.jsx("option",{value:"amount",children:"Amount"})]}),e.jsx("input",{type:"number",step:"0.01",min:0,className:"flex-1 rounded border p-2",value:t.margin_value,onChange:s=>a("margin_value",s.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Scope"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:t.scope_type,onChange:s=>a("scope_type",s.target.value),children:[e.jsx("option",{value:"all_units",children:"All Units"}),e.jsx("option",{value:"specific_qty",children:"Specific Quantity"})]})]}),t.scope_type==="specific_qty"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Scope Quantity"}),e.jsx("input",{type:"number",min:1,className:"mt-1 w-full rounded border p-2",value:t.scope_qty,onChange:s=>a("scope_qty",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Discount"}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsxs("select",{className:"rounded border p-2",value:t.discount_type,onChange:s=>a("discount_type",s.target.value),children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"percent",children:"Percent"}),e.jsx("option",{value:"amount",children:"Amount"})]}),e.jsx("input",{type:"number",step:"0.01",min:0,className:"flex-1 rounded border p-2",value:t.discount_value,onChange:s=>a("discount_value",s.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Base Price"}),e.jsx("div",{className:"font-semibold",children:d(Number(m||0))})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Sold Price"}),e.jsx("div",{className:"font-semibold",children:d(Number(v||0))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Starts At"}),e.jsx("input",{type:"datetime-local",className:"mt-1 w-full rounded border p-2",value:t.starts_at,onChange:s=>a("starts_at",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Ends At"}),e.jsx("input",{type:"datetime-local",className:"mt-1 w-full rounded border p-2",value:t.ends_at,onChange:s=>a("ends_at",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Notes"}),e.jsx("textarea",{className:"mt-1 w-full rounded border p-2",rows:3,value:t.notes,onChange:s=>a("notes",s.target.value)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(f,{href:route("products.index"),className:"rounded border px-4 py-2",children:"Back"}),e.jsx("button",{disabled:h||!t.product_id,className:"rounded bg-blue-600 px-4 py-2 text-white",children:"Save Rule"})]})]})]})]})}export{k as default};

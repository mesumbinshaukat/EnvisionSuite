import{u as q,a as T,j as e,H as I,L as g}from"./app-BpbEyoxA.js";import{T as n}from"./InfoIcon-BKj8MgZu.js";import{A as K}from"./AuthenticatedLayout-eYnlr3pS.js";import{f as a}from"./currency-DO5TMxe2.js";import"./transition-GXVTtJgq.js";import"./HelpInjector-BdYANK49.js";function V({auth:x,filters:c,revenue:l,expense:o,profit:h,rows:p,cogs:u,grossProfit:d,grossMarginPct:m,operatingExpense:j,series:N=[],compare:v={},bucket:F="daily",top:k={products:[],customers:[]}}){const{t:s}=q(),{data:r,setData:f,get:R,processing:S}=T({from:c.from,to:c.to,bucket:F}),b=(t,i=600,G=120,y=8)=>{if(!N||N.length===0)return"";const _=N.map(w=>Number(w[t]||0)),M=Math.max(1,..._),$=Math.min(0,..._),A=M-$||1,D=(i-y*2)/Math.max(1,N.length-1);return _.map((w,L)=>{const H=y+L*D,O=y+(G-y*2)*(1-(w-$)/A);return`${L===0?"M":"L"}${H.toFixed(1)},${O.toFixed(1)}`}).join(" ")},W=t=>{t.preventDefault(),R(route("reports.accounting.profitLoss"),{preserveState:!0})};return e.jsxs(K,{user:x.user,children:[e.jsx(I,{title:s("profit_loss")}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold flex items-center gap-2",children:[s("profit_loss"),e.jsx(n,{text:s("profit_loss_help"),children:"i"})]}),e.jsx(g,{href:route("reports.accounting.profitLoss.export",r),className:"px-3 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700",children:s("export_excel")})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"px-1 pb-3 font-medium",children:s("trends_over_time")}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{width:"800",height:"160",className:"min-w-[800px]",children:[e.jsx("path",{d:b("revenue",800,140),stroke:"#059669",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:b("expense",800,140),stroke:"#ef4444",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:b("cogs",800,140),stroke:"#f59e0b",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:b("gross",800,140),stroke:"#3b82f6",strokeWidth:"2",fill:"none"})]})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-emerald-600 inline-block"})," ",s("legend_revenue")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-red-500 inline-block"})," ",s("legend_expenses")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-amber-500 inline-block"})," ",s("legend_cogs")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-blue-500 inline-block"})," ",s("legend_gross_profit")]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"font-medium mb-2",children:s("previous_period_comparison")}),v.previous?e.jsx(C,{current:{revenue:l,expense:j,cogs:u,gross:d,profit:h},prev:v.previous}):e.jsx("div",{className:"text-sm text-gray-500",children:s("not_available")})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"font-medium mb-2",children:s("year_over_year_comparison")}),v.yoy?e.jsx(C,{current:{revenue:l,expense:j,cogs:u,gross:d,profit:h},prev:v.yoy}):e.jsx("div",{className:"text-sm text-gray-500",children:s("not_available")})]})]}),e.jsxs("form",{onSubmit:W,className:"bg-white shadow rounded p-4 grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:s("from")}),e.jsx("input",{type:"date",className:"mt-1 w-full border-gray-300 rounded",value:r.from,onChange:t=>f("from",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:s("to_label")}),e.jsx("input",{type:"date",className:"mt-1 w-full border-gray-300 rounded",value:r.to,onChange:t=>f("to",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:s("bucket")}),e.jsxs("select",{className:"mt-1 w-full border-gray-300 rounded",value:r.bucket,onChange:t=>f("bucket",t.target.value),children:[e.jsx("option",{value:"daily",children:s("daily")}),e.jsx("option",{value:"weekly",children:s("weekly")}),e.jsx("option",{value:"monthly",children:s("monthly")})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:S,children:s("apply")})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[s("revenue"),e.jsx(n,{text:s("revenue_accounts_help")})]}),e.jsx("div",{className:"text-2xl font-semibold",children:a(Number(l||0))}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx(g,{href:route("reports.accounting.journals",{from:r.from,to:r.to,scope:"revenue"}),className:"text-indigo-600 hover:underline",children:s("view_detailed_revenue_journals")})})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[s("expenses"),e.jsx(n,{text:s("expense_accounts_help")})]}),e.jsx("div",{className:"text-2xl font-semibold",children:a(Number(o||0))}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx(g,{href:route("reports.accounting.journals",{from:r.from,to:r.to,scope:"expense"}),className:"text-indigo-600 hover:underline",children:s("view_detailed_expense_journals")})})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[s("net_profit"),e.jsx(n,{text:"Net Profit = Revenue - (Expenses + COGS)."})]}),e.jsx("div",{className:`text-2xl font-semibold ${Number(h)>=0?"text-emerald-600":"text-red-600"}`,children:a(Number(h||0))})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:s("cogs_computed")}),e.jsx("div",{className:"text-xl font-semibold",children:a(Number(u||0))})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:s("operating_expenses_excl_cogs")}),e.jsx("div",{className:"text-xl font-semibold",children:a(Number(j||0))})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:s("gross_profit")}),e.jsx("div",{className:`text-xl font-semibold ${Number(d)>=0?"text-emerald-600":"text-red-600"}`,children:a(Number(d||0))})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("div",{className:"text-sm text-gray-500",children:s("gross_margin_pct")}),e.jsx("div",{className:"text-xl font-semibold",children:m==null?"-":`${m}%`})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsxs("div",{className:"px-4 py-2 font-medium flex items-center gap-2",children:[s("revenue_accounts"),e.jsx(n,{text:s("revenue_accounts_help")})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:s("code")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("account")}),e.jsxs("th",{className:"px-4 py-2 text-right",children:[s("amount")," ",e.jsx(n,{text:s("revenue_accounts_help")})]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.revenue.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:t.code}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(g,{href:route("reports.accounting.journals",{from:r.from,to:r.to,scope:`account:${t.code}`}),className:"text-indigo-600 hover:underline",title:s("drill_down_account_journals"),children:t.name})}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.credit-t.debit))})]},i))})]})]}),e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsxs("div",{className:"px-4 py-2 font-medium flex items-center gap-2",children:[s("expense_accounts"),e.jsx(n,{text:s("expense_accounts_help")})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:s("code")}),e.jsx("th",{className:"px-4 py-2 text-left",children:s("account")}),e.jsxs("th",{className:"px-4 py-2 text-right",children:[s("amount")," ",e.jsx(n,{text:s("expense_accounts_help")})]})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.expense.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:t.code}),e.jsx("td",{className:"px-4 py-2",children:t.code==="COGS"?e.jsx("span",{title:s("computed_avg_cost_note"),children:t.name}):e.jsx(g,{href:route("reports.accounting.journals",{from:r.from,to:r.to,scope:`account:${t.code}`}),className:"text-indigo-600 hover:underline",title:s("drill_down_account_journals"),children:t.name})}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.debit-t.credit))})]},i))})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 font-medium",children:s("top_products_by_gross_profit")}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:s("product")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("qty")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("revenue")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("cogs")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("gross_profit")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:(k.products||[]).map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-right",children:Number(t.qty)}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.revenue||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.cogs||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.gross||0))})]},i))})]})]}),e.jsxs("div",{className:"bg-white shadow rounded overflow-x-auto",children:[e.jsx("div",{className:"px-4 py-2 font-medium",children:s("top_customers_by_gross_profit")}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:s("customer")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("qty")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("revenue")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("cogs")}),e.jsx("th",{className:"px-4 py-2 text-right",children:s("gross_profit")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:(k.customers||[]).map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:t.customer_id?e.jsx(g,{href:route("customers.ledger",t.customer_id),className:"text-indigo-600 hover:underline",title:s("drill_customer_ledger"),children:t.name}):e.jsx("span",{children:t.name})}),e.jsx("td",{className:"px-4 py-2 text-right",children:Number(t.qty)}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.revenue||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.cogs||0))}),e.jsx("td",{className:"px-4 py-2 text-right",children:a(Number(t.gross||0))})]},i))})]})]})]})]})]})}function C({current:x,prev:c}){const{t:l}=q(),o=({label:p,cur:u,pv:d})=>{const m=Number(u)-Number(d),j=Number(d)!==0?m/Number(d):null;return e.jsxs("div",{className:"grid grid-cols-5 text-sm py-1",children:[e.jsx("div",{className:"col-span-2 text-gray-600",children:p}),e.jsx("div",{className:"text-right",children:a(Number(u||0))}),e.jsx("div",{className:"text-right text-gray-500",children:a(Number(d||0))}),e.jsxs("div",{className:`text-right ${m>=0?"text-emerald-600":"text-red-600"}`,children:[m>=0?"+":"",a(m)," ",j==null?"":" ("+h(j)+")"]})]})},h=p=>`${(p*100).toFixed(1)}%`;return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-5 text-xs text-gray-500 border-b pb-1",children:[e.jsx("div",{className:"col-span-2",children:l("metric")}),e.jsx("div",{className:"text-right",children:l("current")}),e.jsx("div",{className:"text-right",children:l("previous")}),e.jsx("div",{className:"text-right",children:l("delta_vs_prev")})]}),e.jsx(o,{label:l("revenue"),cur:x.revenue,pv:c.revenue}),e.jsx(o,{label:l("expenses"),cur:x.expense,pv:c.expense}),e.jsx(o,{label:l("cogs"),cur:x.cogs,pv:c.cogs}),e.jsx(o,{label:l("gross_profit"),cur:x.gross,pv:c.gross}),e.jsx(o,{label:l("net_profit"),cur:x.profit,pv:c.profit})]})}export{V as default};

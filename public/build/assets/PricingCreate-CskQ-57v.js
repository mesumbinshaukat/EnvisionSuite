import{r as d,u as j,j as e,H as b,L as f}from"./app-3WHj1xnA.js";import{f as n}from"./currency-DO5TMxe2.js";import{A as N}from"./AuthenticatedLayout-DMhsWmQ9.js";import"./transition-C8ASTdTE.js";function k({purchasedProducts:r=[]}){const[c,x]=d.useState(""),p=d.useMemo(()=>{const s=c.toLowerCase();return s?r.filter(i=>(i.name||"").toLowerCase().includes(s)||(i.sku||"").toLowerCase().includes(s)):r},[c,r]),{data:t,setData:a,post:h,processing:u}=j({product_id:"",cost_basis:"fixed",fixed_cost:"",margin_type:"percent",margin_value:"20",scope_type:"all_units",scope_qty:"",discount_type:"none",discount_value:"",starts_at:"",ends_at:"",notes:""}),l=d.useMemo(()=>r.find(s=>s.id===parseInt(t.product_id))||null,[t.product_id,r]),o=d.useMemo(()=>l?t.cost_basis==="fixed"?parseFloat(t.fixed_cost||0):t.cost_basis==="last"?parseFloat(l.last_cost||0):parseFloat(l.avg_cost||0):0,[l,t.cost_basis,t.fixed_cost]),m=d.useMemo(()=>{const s=parseFloat(o||0),i=parseFloat(t.margin_value||0);return t.margin_type==="amount"?Math.max(0,s+i):Math.max(0,s*(1+Math.max(0,i)/100))},[o,t.margin_type,t.margin_value]),v=d.useMemo(()=>{const s=parseFloat(m||0),i=parseFloat(t.discount_value||0);return t.discount_type==="amount"?Math.max(0,s-Math.max(0,i)):t.discount_type==="percent"?Math.max(0,s*(1-Math.max(0,Math.min(100,i))/100)):s},[m,t.discount_type,t.discount_value]),g=s=>{s.preventDefault(),h(route("pricing.store"))};return e.jsxs(N,{header:e.jsx("h2",{className:"text-xl font-semibold",children:"Create Pricing Rule"}),children:[e.jsx(b,{title:"Create Pricing Rule"}),e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsxs("div",{className:"rounded bg-white p-4 shadow",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Search Products"}),e.jsx("input",{value:c,onChange:s=>x(s.target.value),className:"mt-1 w-full rounded border p-2",placeholder:"Search by name or SKU"})]}),e.jsxs("div",{className:"w-80",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Select Product"}),e.jsxs("select",{value:t.product_id,onChange:s=>a("product_id",s.target.value),className:"mt-1 w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"-- choose --"}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.sku,")"]},s.id))]})]})]}),l&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded bg-gray-50 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Last Cost"}),e.jsx("div",{className:"font-medium",children:n(l.last_cost)})]}),e.jsxs("div",{className:"rounded bg-gray-50 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Average Cost"}),e.jsx("div",{className:"font-medium",children:n(l.avg_cost)})]}),e.jsxs("div",{className:"rounded bg-gray-50 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Current Price"}),e.jsx("div",{className:"font-medium",children:n(l.price)})]}),e.jsxs("div",{className:"rounded bg-gray-50 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Available Stock"}),e.jsx("div",{className:"font-medium",children:l.stock||0})]})]})]}),e.jsxs("form",{onSubmit:g,className:"rounded bg-white p-6 shadow space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Cost Basis"}),e.jsxs("select",{value:t.cost_basis,onChange:s=>a("cost_basis",s.target.value),className:"mt-1 w-full rounded border p-2",children:[e.jsx("option",{value:"average",children:"Weighted Average"}),e.jsx("option",{value:"last",children:"Last Purchase"}),e.jsx("option",{value:"fixed",children:"Fixed Cost/Buy Price"})]})]}),t.cost_basis==="fixed"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Fixed Cost/Buy Price"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.fixed_cost,onChange:s=>a("fixed_cost",s.target.value),className:"mt-1 w-full rounded border p-2",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Selling Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.margin_type,onChange:s=>a("margin_type",s.target.value),className:"mt-1 rounded border p-2",children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"amount",children:"Amount"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.margin_value,onChange:s=>a("margin_value",s.target.value),className:"mt-1 flex-1 rounded border p-2",placeholder:"20"})]}),e.jsx("div",{className:"mt-1 text-sm text-gray-600",children:t.margin_type==="percent"?"Percentage above cost":"Fixed amount above cost"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Scope Type"}),e.jsxs("select",{value:t.scope_type,onChange:s=>a("scope_type",s.target.value),className:"mt-1 w-full rounded border p-2",children:[e.jsx("option",{value:"all_units",children:"All Units"}),e.jsx("option",{value:"specific_qty",children:"Specific Quantity"})]})]})]}),t.scope_type==="specific_qty"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Scope Quantity"}),e.jsx("input",{type:"number",min:"1",max:l?.stock||999999,value:t.scope_qty,onChange:s=>a("scope_qty",s.target.value),className:"mt-1 w-full rounded border p-2",placeholder:"Enter quantity"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:["Available stock: ",e.jsx("span",{className:"font-medium",children:l?.stock||0})," units"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Discount Type"}),e.jsxs("select",{value:t.discount_type,onChange:s=>a("discount_type",s.target.value),className:"mt-1 w-full rounded border p-2",children:[e.jsx("option",{value:"none",children:"No Discount"}),e.jsx("option",{value:"percent",children:"Percentage"}),e.jsx("option",{value:"amount",children:"Fixed Amount"})]})]}),t.discount_type!=="none"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Discount Value"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:t.discount_type==="percent"?100:void 0,value:t.discount_value,onChange:s=>a("discount_value",s.target.value),className:"mt-1 w-full rounded border p-2",placeholder:t.discount_type==="percent"?"0-100":"0.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Start Date"}),e.jsx("input",{type:"date",value:t.starts_at,onChange:s=>a("starts_at",s.target.value),className:"mt-1 w-full rounded border p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"End Date"}),e.jsx("input",{type:"date",value:t.ends_at,onChange:s=>a("ends_at",s.target.value),className:"mt-1 w-full rounded border p-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:s=>a("notes",s.target.value),rows:"3",className:"mt-1 w-full rounded border p-2",placeholder:"Additional notes about this pricing rule"})]}),l&&e.jsx("div",{className:"rounded bg-blue-50 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-blue-600",children:"Cost Basis"}),e.jsx("div",{className:"font-medium",children:n(o)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-blue-600",children:"Base Price"}),e.jsx("div",{className:"font-medium",children:n(m)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-blue-600",children:"Final Price"}),e.jsx("div",{className:"font-medium",children:n(v)})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(f,{href:route("pricing.index"),className:"rounded border px-4 py-2 text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:u?"Creating...":"Create Pricing Rule"})]})]})]})]})}export{k as default};

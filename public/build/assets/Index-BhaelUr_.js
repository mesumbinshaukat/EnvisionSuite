import{u as T,j as e,H as P}from"./app-BY2_RXAK.js";import{A as S}from"./AuthenticatedLayout-Bx35s1Fr.js";import{T as C}from"./InfoIcon-CjmUhCtz.js";import{f as n}from"./currency-DO5TMxe2.js";import"./transition-CRMZObkh.js";import"./HelpInjector-CKGuYAzS.js";function Q({customers:b,products:m}){const{data:l,setData:c,post:N,processing:f,errors:u}=T({customer_id:"",payment_method:"cash",amount_paid:"",items:[]}),v=t=>{const a=m.find(s=>s.id===parseInt(t));a&&c("items",[...l.items,{product_id:a.id,quantity:1}])},y=(t,a)=>{const s=[...l.items],i=s[t],r=m.find(h=>h.id===i.product_id),o=Math.max(0,parseInt(r?.stock??0));let d=parseInt(a)||1;o>0&&d>o&&(d=o),d<1&&(d=1),s[t].quantity=d,c("items",s)},g=t=>{const a=[...l.items];a.splice(t,1),c("items",a)},k=t=>{t.preventDefault(),N(route("pos.checkout"))},p=t=>{const a=m.find(w=>w.id===t.product_id),s=Number(a?.price||0),i=Number(t.quantity||0),r=Number(a?.tax_rate||0),o=s*i,d=o*Math.max(0,r)/100,h=o+d;return{price:s,qty:i,taxRate:r,lineSubtotal:o,lineTax:d,lineTotal:h}},x=l.items.reduce((t,a)=>{const s=p(a);return t.subtotal+=s.lineSubtotal,t.tax+=s.lineTax,t.total+=s.lineTotal,t},{subtotal:0,tax:0,total:0}),j=(()=>{const t=parseFloat(l.amount_paid||0);return isNaN(t)||t<0?0:Math.min(t,x.total)})(),_=Math.max(0,Math.round((x.total-j)*100)/100);return e.jsxs(S,{header:e.jsx("h2",{className:"text-xl font-semibold",children:"Point of Sale"}),children:[e.jsx(P,{title:"POS"}),e.jsx("div",{className:"mx-auto max-w-5xl p-6",children:e.jsxs("form",{onSubmit:k,className:"space-y-4 bg-white p-6 shadow rounded",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Customer"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:l.customer_id,onChange:t=>c("customer_id",t.target.value),children:[e.jsx("option",{value:"",children:"Walk-in"}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Payment"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:l.payment_method,onChange:t=>c("payment_method",t.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Amount Paid"}),e.jsx("input",{type:"number",min:0,step:"0.01",className:"mt-1 w-full rounded border p-2",value:l.amount_paid,onChange:t=>c("amount_paid",t.target.value)}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Paid now will be recorded against this sale."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium",children:["Add Product ",e.jsx(C,{text:"Add items to the cart. Quantity cannot exceed available stock.",children:"i"})]}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",onChange:t=>v(t.target.value),children:[e.jsx("option",{value:"",children:"Select product"}),m.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.sku,") - Stock: ",t.stock??0]},t.id))]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left",children:"Product"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-2 py-2",children:"Qty"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Line Subtotal"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Tax"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Line Total"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Available"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:l.items.map((t,a)=>{const s=m.find(r=>r.id===t.product_id),i=p(t);return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-2 py-2",children:s?.name}),e.jsx("td",{className:"px-2 py-2 text-right",children:n(i.price)}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("input",{type:"number",min:1,max:Math.max(1,s?.stock??1),className:"w-24 rounded border p-2",value:t.quantity,onChange:r=>y(a,r.target.value),title:`Max ${s?.stock??0} available`})}),e.jsx("td",{className:"px-2 py-2 text-right",children:n(i.lineSubtotal)}),e.jsx("td",{className:"px-2 py-2 text-right",children:n(i.lineTax)}),e.jsx("td",{className:"px-2 py-2 text-right font-semibold",children:n(i.lineTotal)}),e.jsx("td",{className:"px-2 py-2 text-right",children:s?.stock??0}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>g(a),className:"text-red-600",children:"Remove"})})]},a)})})]})}),u.items&&e.jsx("div",{className:"text-sm text-red-600",children:u.items}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Subtotal: ",e.jsx("span",{className:"font-semibold",children:n(x.subtotal)})]}),e.jsxs("div",{children:["Tax: ",e.jsx("span",{className:"font-semibold",children:n(x.tax)})]}),e.jsxs("div",{children:["Total: ",e.jsx("span",{className:"font-semibold",children:n(x.total)})]}),e.jsxs("div",{children:["Paid: ",e.jsx("span",{className:"font-semibold",children:n(j)})]}),e.jsxs("div",{children:["Balance: ",e.jsx("span",{className:"font-semibold",children:n(_)})]})]}),e.jsx("button",{disabled:f,className:"rounded bg-blue-600 px-4 py-2 text-white",children:"Checkout"})]})]})})]})}export{Q as default};

import{u as b,a as j,r as g,j as e,H as _,L as x}from"./app-BpbEyoxA.js";import{A as N}from"./AuthenticatedLayout-eYnlr3pS.js";import"./transition-GXVTtJgq.js";import"./HelpInjector-BdYANK49.js";import"./InfoIcon-BKj8MgZu.js";function S({auth:p,vendors:m,vendorDebts:u={},balances:i={}}){const{t}=b(),{data:s,setData:n,post:h,processing:y,errors:r}=j({counterparty_type:"vendor",vendor_id:m?.[0]?.id??"",counterparty_name:"",direction:"lend",source:"cash",amount:"",date:new Date().toISOString().slice(0,10),note:"",purpose:"general"}),o=a=>Number(a||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),d=g.useMemo(()=>{const a=s.vendor_id?Number(s.vendor_id):null;if(!a)return 0;const l=u?.[a]??0;return Number(l||0)},[s.vendor_id,u]),c=s.source==="bank"?Number(i?.bank||0):Number(i?.cash||0),v=a=>{a.preventDefault();const l=Number(s.amount||0);if(l<=0){alert(t("amount")+" "+t("must_be_positive"));return}if((s.direction==="lend"||s.purpose==="vendor_payoff")&&l>c+1e-6){alert(t("insufficient_funds")+`: ${t(s.source)} ${o(c)}`);return}if(s.purpose==="vendor_payoff"){if(s.counterparty_type!=="vendor"||!s.vendor_id){alert(t("vendor")+" "+t("is_required"));return}if(l>d+1e-6){alert(t("amount")+" > "+t("Pending Debt")+` (${o(d)})`);return}if(d<=0){alert(t("No Pending Debt For Selected Vendor"));return}}h(route().has("transactions.store")?route("transactions.store"):route("money.loans.store"))};return e.jsxs(N,{user:p?.user,children:[e.jsx(_,{title:t("Transactions")}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold","data-help-key":"transactions_create_title",children:t("Transactions")}),e.jsx(x,{href:route().has("transactions.index")?route("transactions.index"):route("money.loans.index"),className:"px-3 py-2 bg-gray-100 rounded",children:t("back")})]}),e.jsxs("form",{onSubmit:v,className:"bg-white p-4 rounded shadow space-y-4 max-w-2xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-gray-500",children:[t("cash")," ",t("balance")]}),e.jsx("div",{className:"font-semibold",children:o(i?.cash)})]}),e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-gray-500",children:[t("bank")," ",t("balance")]}),e.jsx("div",{className:"font-semibold",children:o(i?.bank)})]}),s.counterparty_type==="vendor"&&e.jsxs("div",{className:"p-3 rounded border bg-amber-50",children:[e.jsx("div",{className:"text-gray-600",children:t("Pending Debt")}),e.jsx("div",{className:"font-semibold",children:o(d)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_counterparty_type",children:t("counterparty_type")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:s.counterparty_type,onChange:a=>n("counterparty_type",a.target.value),children:[e.jsx("option",{value:"vendor",children:t("vendor")}),e.jsx("option",{value:"external",children:t("external_person")})]}),r.counterparty_type&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.counterparty_type})]}),s.counterparty_type==="vendor"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_vendor",children:t("vendor")}),e.jsx("select",{className:"w-full border rounded px-3 py-2",value:s.vendor_id??"",onChange:a=>n("vendor_id",a.target.value),children:(m||[]).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))}),r.vendor_id&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.vendor_id})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_counterparty_name",children:t("external_person")}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:s.counterparty_name,onChange:a=>n("counterparty_name",a.target.value)}),r.counterparty_name&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.counterparty_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_direction",children:t("direction")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:s.direction,onChange:a=>n("direction",a.target.value),children:[e.jsx("option",{value:"lend",children:t("lend")}),e.jsx("option",{value:"borrow",children:t("borrow")})]}),r.direction&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.direction})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_purpose",children:t("purpose")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:s.purpose,onChange:a=>n("purpose",a.target.value),children:[e.jsx("option",{value:"general",children:t("general")}),e.jsx("option",{value:"vendor_payoff",children:t("Payoff Vendor Debt")})]}),r.purpose&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.purpose})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_source",children:t("source")}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:s.source,onChange:a=>n("source",a.target.value),children:[e.jsx("option",{value:"cash",children:t("cash")}),e.jsx("option",{value:"bank",children:t("bank")})]}),r.source&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.source})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_amount",children:t("amount")}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full border rounded px-3 py-2",value:s.amount,onChange:a=>n("amount",a.target.value),max:s.purpose==="vendor_payoff"?d:void 0}),r.amount&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.amount}),(s.direction==="lend"||s.purpose==="vendor_payoff")&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t("available")," ",t(s.source),": ",o(c)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_date",children:t("date")}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:s.date,onChange:a=>n("date",a.target.value)}),r.date&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.date})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1","data-help-key":"money_loans_note",children:t("note")}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:s.note,onChange:a=>n("note",a.target.value)}),r.note&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:r.note})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-60",children:t("save")}),e.jsx(x,{href:route().has("transactions.index")?route("transactions.index"):route("money.loans.index"),className:"px-4 py-2 bg-gray-100 rounded",children:t("cancel")})]})]})]})]})}export{S as default};
